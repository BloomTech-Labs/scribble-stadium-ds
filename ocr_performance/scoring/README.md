These modules are currently not working as the directory structure has changed since they where created
====

Usage
=====
Before attempting to run these commands, please do the following

* Talk to your DS lead and obtain access to the zip archive containing image files and reference transcripts for the 167 stories.
* Unpack it inthe `data` dir of your repo - you should see `photos` and `transcripts` sub dirs containing the 314 image(.jpg)  and 167 reference transcript(.txt) files respectively.
* Obtain the `GOOGLE_CREDS` required to use Google's Cloud Vision API and stick it in a `.env` file located in your repo's root dir.

All subsequent commands must be perfrormed in your repo's root dir.

Working with a new Tesseract language model(.trainedata) file
--------------------------------------------------------------

* The first step is to copy the model file into your repo's `data` dir - `cp <new .trainedata file> data/storysquad.trainedata`
* Generate transcripts with the new model - `python -m ocr_performance.google_tesseract_transcripts`
* Compute OCR performance - `python -m ocr_performance.ocr_performance`
* Add and commit files to the repo - `git add data/storysquad.trainedata data/tess_storysquad_cos_error.csv; git commit -m "Latest lang and perf csv files for Tesseract" `

Regenerating Google transcripts
-------------------------------
* Generate transcripts  - `python -m ocr_performance.google_tesseract_transcripts -e google`
* Compute OCR performance - `python -m ocr_performance.ocr_performance -e google`
* Add and commit files to the repo - `git add data/google_cos_error.csv; git commit -m "Latest perf csv file for Google" `


google_tesseract_transcripts.py
===============================
`python -m ocr_performance.google_tesseract_transcripts -h`

    usage: google_tesseract_transcripts.py [-h] [-e {google,tess}] [-l {ssq,storysquad}
    
    optional arguments:
      -h, --help            show this help message and exit
      -e {google,tess}, --engine {google,tess}
                            Specify transcribe engine
                            #default - tess
      -l {ssq,storysquad}, --language {ssq,storysquad}
                            Specify language for Tesseract engine`
                            #default - storysquad
The command line is executed from the root of the git repo and runs the 167 story image files from the Story Squad data set through either the Google or Tesseract OCR engines. 

It expects to find the images under `.../data/photos`.

The transcripts themselves are written out to a location based on the transcription engine and , in the case of the Tesseract engine, the language specified:

`google -> .../data/google_transcripts`

`tess+ssq -> .../data/tess_ssq_transcripts`

`tess+storysquad -> .../data/tess_storysquad_transcripts`

NOTE:
-----
* Created `app.utils.img_processing.tesseract_api.TesseractAPI` as a drop in replacement for `app.utils.img_processing.google_api.GoogleAPI`
* The Tesseract language files(`ssq.trainedata` and `storysquad.trainedata`) are stored in `.../models`

    * `ssq.trainedata` is from Dakota's [tesstrain](https://github.com/dakotagporter/tesstrain) repo - it was trained on 75% of the data from the 31â€“ folder.
    * `storysquad.trainedata` is from SaraW - it was trained on the 32- folder and 50% of the 52- folder.
* When the google engine is used, `GOOGLE_CREDS` must be defined in `.../.env`

ocr_performance.py
==================

`python -m ocr_performance.ocr_performance -h`

    usage: ocr_performance.py [-h] [-e {google,tess,ref}] [-l {ssq,storysquad}]
    
    optional arguments:
      -h, --help            show this help message and exit
      -e {google,tess,ref}, --engine {google,tess,ref}
                            Specify transcribe engine
                            #default - tess
      -l {ssq,storysquad}, --language {ssq,storysquad}
                            Specify language for Tesseract engine
                            #defaut - storysquad
                            
The command line is executed from the root of the git repo and compares the hypothesis transcriptions to the reference transcriptions and generates a CSV file containing the error value per image as well as a summary mean error value.

The `reference` transcripts are expected at `.../data/transcripts` and other `engine+lang` transcripts are expected at the paths specified for the `google_tesseract_transcripts` script.

The CSV files are written out to a location based on the transcription engine and , in the case of the Tesseract engine, the language specified:

`ref    -> .../data/ref_cos_error.csv`

`google -> .../data/google_cos_error.csv`

`tess+ssq -> .../data/tess_ssq_cos_error.csv`

`tess+storysquad -> .../data/tess_storysquad_cos_error.csv`

NOTE:
-----
* This file uses the following serialized/pickled files located in `.../models` and generated by `.../notebooks/TranscriptionProcessing.ipynb`

    *   `file_roots.pkl` - list of file roots for the various imaage files
    *   `tfidf.pkl` - Tfidf vectorizer
    *   `encoder.h5` - Dimensionality reducing encoder
    *   `encoded_ref_dtm.pkl` - Encoded(dimensionality reduced) DTM(Document Term Matrix) for the reference transcripts


